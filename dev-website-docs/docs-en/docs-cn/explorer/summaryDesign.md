数据统计功能分每日统计（每天）和实时统计（每10分钟）
## Daily
exporer程序自动在凌晨（00：10：00）执行统计，统计包含每日区块数、每日活跃ontId数、每日新增ontId数、每日交易数、每日交易额度、每日活动地址数、每日新增地址数、合约每日交易量、合约每日活跃地址数、合约每日新增地址数、合约每日交易额度。

### 数据准备：
 
 凌晨（00：10：00）将前一天内所有交易数据从txn_detail表插入临时表txn_detail_tmp，然后基于这部分数据进行统计；

### 日常统计：

1）每日区块数: 一天内生成的区块数量

    实现逻辑：统计block表中一天内所有区块高度，去重即为当天生成区块的数量；
    
2）每日活跃ontId数：一天内参与交易的ontId数

    实现逻辑：统计ontid_detail表中一天内的所有交易hash，去重即为当天活跃ontId的数量；

3）每日新增ontId数：一天内参与交易ontId中属于新增ontId的数量

    实现逻辑：统计ontid_detail表中一天内的所有交易描述带有“Register”的交易hash，去重即为当天新增ontId的数量；
    
4）每日交易数：一天内所有交易的数量

    实现逻辑：统计txn_detail_tmp表中一天内的所有交易hash，去重即为当天的交易数；

5）每日交易额度：一天内所有交易涉及到ont和ong的流水（流入和流出的总量）

    实现逻辑： 统计txn_detail_tmp表中一天内的所有资产名称分别为“ont”和“ong”的交易，累加转账金额即为当天ONT和ONG的交易额度；

6）每日活动地址数：一天内所有交易涉及地址的数量

    实现逻辑：统计txn_detail_tmp表中一天内的所有交易的来源地址(fromAddress)和目的地址(toAddress)，
    去重并筛选符合标准(长度为34)的地址数即为当天的活跃地址数；

7）每日新增地址数：一天内所有交易涉及地址中属于新增地址的数量

    实现逻辑：统计txn_detail_tmp表中一天内的所有交易的来源地址(fromAddress)和目的地址(toAddress)，
    去重并筛选符合标准(长度为34)的地址，然后从address_summary表中查出历史地址，去重即为当天新增地址的数量；

8）其他逻辑：

    将每天的新增地址，按照当天00:00:00的时间戳，类型为“common”，存入address_summary表；

    将每天的各个统计项，按照当天00:00:00的时间戳，存入daily_summary表；


### 合约统计：

1）数据准备：

    查询contracts表中所有的合约，用于后续统计；

2）合约每日交易量：一天内合约涉及所有交易的数量

    实现逻辑：统计交易的合约hash为目标合约hash的所有交易的数量；

3）合约每日活跃地址数：一天内合约涉及所有地址的数量

    实现逻辑：统计交易的源、目的地址分别为合约地址（contracthash转换之后的标准地址）的所有交易的目的、源地址，
    加上交易的合约hash为contracthash的所有交易的源、目的地址，去重并筛选符合标准(长度为34)的地址数即为当天合约活跃地址数量；

4）合约每日新增地址数：一天内合约涉及所有交易涉及地址中属于新增地址的数量

    实现逻辑：统计交易的源、目的地址分别为合约地址（contracthash转换之后的标准地址）的所有交易的目的、源地址，
    加上交易的合约hash为contracthash的所有交易的源、目的地址，去重并筛选符合标准(长度为34)的地址，
    然后从address_summary表中查询历史地址，
    去重即为当天合约新增地址的数量；

5）合约每日交易额度：一天内合约所有交易涉及到ont和ong的流水（流入和流出的总量）

    实现逻辑：统计交易的源、目的地址分别为合约地址（目标合约hash转换之后的标准地址）和交易的合约hash为contracthash，
    并且资产名称分别为“ont”和“ong”的交易，累加转账金额即为当天合约的ONT和ONG交易额度；

6）其他逻辑：

    将合约每天的新增地址，按照当天00:00:00的时间戳，类型为contracthash，存入address_summary表；

    将合约每天的各个统计项，按照当天00:00:00的时间戳，存入contract_summary表；


## RealTime

exporer程序自动每10分钟执行统计，统计包含合约实时总交易量、合约实时总地址数、合约实时总交易额度、合约实时token总交易额。

（1）数据准备：

    查询contracts表中所有通过人工验证（auditflag为1，默认为0）的合约，用于后续统计；

    检查txn_detail_daily表是否包含前一天的交易数据，如果存在，即删除之，确保此表只保留当天的交易；

（2）合约实时总交易量：当前时刻合约所有交易的总数量

    实现逻辑：查询contract_summary表当前合约历史每天交易数量的总和，加上今天合约涉及所有交易的交易数量，即为合约实时总交易量；

（3）合约实时总地址数：当前时刻合约所有交易的总地址

    实现逻辑：查询contract_summary表当前合约历史每天新增地址数量的总和，加上今天合约涉及所有交易的新增地址数
    （查询今天所有地址数，并筛选符合标准的地址，然后从address_summary表中查询历史地址，去重即为新增地址数），
    即为合约实时总地址数；

（4）合约实时总交易额度：当前时刻合约所有交易涉及到ont和ong的总流水（流入和流出的总量）

    实现逻辑：查询contract_summary表当前合约历史每天资产分别为ont和ong的总和，加上当天资产分别为ont和ong的所有交易金额，
    即为合约实时ont和ong总交易额；

（5）合约实时token总交易额：当前时刻合约（仅token合约）所有交易涉及token的总流水（累加）

    实现逻辑：

    1）oep5：统计txn_detail表中合约hash为contracthash，并且描述信息为“transfer”的所有交易，统计所有资产额度，
    并将资产名称（云斗龙资产：HyperDragons: 362）处理为统一格式；

    2）非oep5：统计txn_detail表中合约hash为contracthash，并且描述信息为“transfer”的所有交易，
    统计各个token的金额（oep8包含多个token）；


备注：

txn_detail_tmp表用于每天统计，每天凌晨从txn_detail表插入前一天的数据，包括日常统计和合约统计；

txn_detail_daily表用于实时统计，定期删除前一天的数据，确保只保留当天的数据.





